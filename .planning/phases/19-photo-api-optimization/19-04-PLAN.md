---
phase: 19-photo-api-optimization
plan: 04
type: execute
wave: 4
depends_on: ["19-03"]
files_modified:
  - download-photos-from-sportlink.js
  - sync-photos.js
  - package.json
  - CLAUDE.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "Old browser-based photo download script is removed from codebase"
    - "Separate sync-photos.js orchestrator is removed"
    - "Documentation reflects new photo sync behavior (hourly with people)"
    - "npm scripts are updated to remove obsolete entries"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Updated documentation for photo sync changes"
      contains: "photos now sync hourly"
    - path: "package.json"
      provides: "Updated npm scripts without sync-photos reference"
  key_links:
    - from: "CLAUDE.md"
      to: "sync-people.js"
      via: "Documentation references people pipeline for photos"
      pattern: "sync-people"
---

<objective>
Clean up obsolete files and update documentation.

Purpose: Remove the old browser-based photo download script and separate photo sync orchestrator. Update documentation to reflect that photos now sync hourly as part of the people pipeline. This completes the Phase 19 migration.

Output: Codebase cleanup, updated documentation.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-photo-api-optimization/19-03-PLAN.md
@.planning/phases/19-photo-api-optimization/19-CONTEXT.md
@CLAUDE.md
@README.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete obsolete photo scripts</name>
  <files>download-photos-from-sportlink.js, sync-photos.js</files>
  <action>
Delete the old browser-based photo scripts that are now replaced:

```bash
rm download-photos-from-sportlink.js
rm sync-photos.js
```

These files are:
- `download-photos-from-sportlink.js` (298 lines) - Browser automation replaced by download-photos-from-api.js
- `sync-photos.js` (250 lines) - Orchestrator replaced by integration into sync-people.js

Git history preserves these files if rollback is ever needed.

Verify deletion with:
```bash
ls -la download-photos-from-sportlink.js sync-photos.js 2>&1 | grep -c "No such file"
# Should output: 2
```
  </action>
  <verify>
Confirm files are deleted: `ls download-photos-from-sportlink.js 2>&1` shows "No such file"
Confirm files are deleted: `ls sync-photos.js 2>&1` shows "No such file"
  </verify>
  <done>
download-photos-from-sportlink.js deleted (replaced by download-photos-from-api.js).
sync-photos.js deleted (integrated into sync-people.js).
  </done>
</task>

<task type="auto">
  <name>Task 2: Update package.json npm scripts</name>
  <files>package.json</files>
  <action>
Update package.json to remove the sync-photos script reference and update related entries.

1. **Remove or update the sync-photos script:**
If there's a "sync-photos" script, change it to run sync-people.js instead (or remove it):

From:
```json
"sync-photos": "node sync-photos.js"
```

To:
```json
"sync-photos": "node sync-people.js"
```

(This maintains backwards compatibility - `npm run sync-photos` still works but runs the integrated pipeline)

2. **Verify no broken references** to download-photos-from-sportlink.js

The goal is that any existing scripts or commands that reference photo sync will still work but now run the integrated people pipeline.
  </action>
  <verify>
Run: `npm run --list` to verify no broken scripts
Check package.json for any remaining references to sync-photos.js
  </verify>
  <done>
package.json updated - sync-photos script runs people sync.
No broken references to deleted files.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md documentation</name>
  <files>CLAUDE.md</files>
  <action>
Update CLAUDE.md to reflect the Phase 19 changes:

1. **Update Quick Reference section** - Change photo sync from daily to hourly:

From:
```bash
scripts/sync.sh photos    # Daily: photo download + upload
```

To:
```bash
scripts/sync.sh photos    # Now runs people sync (photos integrated)
```

Or simply remove the separate photos line and update people:
```bash
scripts/sync.sh people    # Hourly: members, parents, birthdays, photos
```

2. **Update Architecture section** - Remove Photo Pipeline as separate, merge into People:

In the "Sync Architecture" section, update from 5 pipelines to 4 pipelines.

Change "**2. Photo Pipeline (daily via sync-photos.js):**" to be part of People Pipeline:

```markdown
**1. People Pipeline (hourly via sync-people.js):**
- download-data-from-sportlink.js - Browser automation downloads member data + photo URLs
- prepare-laposta-members.js - Transforms Sportlink fields for Laposta
- submit-laposta-list.js - Syncs to Laposta via API (hash-based change detection)
- submit-stadion-sync.js - Syncs members to Stadion WordPress
- sync-important-dates.js - Syncs birthdays to Stadion calendar
- download-photos-from-api.js - Downloads photos via direct HTTP fetch
- upload-photos-to-stadion.js - Uploads photos to Stadion via REST API
```

Remove the separate "**2. Photo Pipeline**" section.

3. **Update Data Flow diagram** - Merge photo flow into people:

```markdown
People (hourly):
Sportlink Club → SQLite → Laposta API (hash-based diff)
                       ↓
              Stadion WordPress API (members)
                       ↓
              Stadion Calendar API (birthdays)
                       ↓
              Photo.Url → downloads/ → Stadion WordPress API (media upload)
```

4. **Update Cron Automation section:**

From:
```markdown
- **People sync:** Hourly (members, parents, birthdays)
- **Photo sync:** Daily at 6:00 AM Amsterdam time
```

To:
```markdown
- **People sync:** Hourly (members, parents, birthdays, photos)
```

5. **Update Development section** if it mentions sync-photos:

Change any references from `npm run sync-photos` to note it's now part of people sync.
  </action>
  <verify>
Grep CLAUDE.md for "Photo Pipeline" - should not exist as separate section
Grep CLAUDE.md for "hourly" near "photos" to confirm integration documented
Grep CLAUDE.md for "sync-photos.js" - should be removed or updated
  </verify>
  <done>
CLAUDE.md updated to document photo sync integration into people pipeline.
Removed references to separate photo pipeline.
Updated cron schedule documentation.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `ls download-photos-from-sportlink.js` returns "No such file"
2. `ls sync-photos.js` returns "No such file"
3. `npm run --list` shows no errors (no broken scripts)
4. CLAUDE.md documents photos as part of hourly people sync
5. No references to "Photo Pipeline" as separate pipeline
6. Cron documentation shows 4 schedules (not 5)
</verification>

<success_criteria>
- download-photos-from-sportlink.js and sync-photos.js deleted
- package.json has no broken script references
- CLAUDE.md documents integrated photo sync (hourly with people)
- Architecture shows 4 pipelines (photos merged into people)
- Cron documentation shows 4 jobs
- All existing `npm run sync-photos` commands still work (backwards compat)
</success_criteria>

<output>
After completion, create `.planning/phases/19-photo-api-optimization/19-04-SUMMARY.md`
</output>
