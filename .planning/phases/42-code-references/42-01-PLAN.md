---
phase: 42-code-references
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - steps/submit-rondo-club-sync.js
  - steps/upload-photos-to-rondo-club.js
  - steps/prepare-freescout-customers.js
  - steps/sync-nikki-to-rondo-club.js
  - steps/download-functions-from-sportlink.js
autonomous: true

must_haves:
  truths:
    - "All stadion references in people-pipeline step files are renamed to rondo_club"
    - "SQL queries in steps use rondo_club_members and rondo_club_parents table names"
    - "Variable names use rondo_club_id instead of stadion_id throughout"
    - "Function names use RondoClub instead of Stadion throughout"
  artifacts:
    - path: "steps/submit-rondo-club-sync.js"
      provides: "Member and parent sync to Rondo Club"
      contains: "rondo_club_id"
    - path: "steps/upload-photos-to-rondo-club.js"
      provides: "Photo upload/delete to Rondo Club"
      contains: "uploadPhotoToRondoClub"
    - path: "steps/prepare-freescout-customers.js"
      provides: "FreeScout customer preparation from Rondo Club data"
      contains: "rondo_club_members"
    - path: "steps/sync-nikki-to-rondo-club.js"
      provides: "Nikki contribution sync"
      contains: "rondo_club_id"
    - path: "steps/download-functions-from-sportlink.js"
      provides: "Function download step"
      contains: "rondo_club_id"
  key_links:
    - from: "steps/submit-rondo-club-sync.js"
      to: "lib/rondo-club-db.js"
      via: "SQL queries and DB function return values"
      pattern: "rondo_club_members|rondo_club_id"
    - from: "steps/upload-photos-to-rondo-club.js"
      to: "lib/rondo-club-db.js"
      via: "member.rondo_club_id from DB queries"
      pattern: "member\\.rondo_club_id"
---

<objective>
Rename all stadion references to rondo_club in the people-pipeline step files: member sync, parent sync, photo upload, FreeScout customer prep, Nikki sync, and function download.

Purpose: Phase 41 migrated the database layer (tables and columns renamed, query functions updated). These step files consume the DB layer output and must now use the new naming (rondo_club_id instead of stadion_id, rondo_club_members instead of stadion_members, etc.).

Output: 5 step files with zero stadion references (except inside migration-related comments if any).
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@steps/submit-rondo-club-sync.js
@steps/upload-photos-to-rondo-club.js
@steps/prepare-freescout-customers.js
@steps/sync-nikki-to-rondo-club.js
@steps/download-functions-from-sportlink.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename stadion references in submit-rondo-club-sync.js and upload-photos-to-rondo-club.js</name>
  <files>steps/submit-rondo-club-sync.js, steps/upload-photos-to-rondo-club.js</files>
  <action>
In `steps/submit-rondo-club-sync.js` (56 references):

**SQL queries (CRITICAL - these query the database directly):**
- `'SELECT knvb_id, stadion_id FROM stadion_members WHERE LOWER(email) = LOWER(?) AND stadion_id IS NOT NULL'` -> `'SELECT knvb_id, rondo_club_id FROM rondo_club_members WHERE LOWER(email) = LOWER(?) AND rondo_club_id IS NOT NULL'`
- `'UPDATE stadion_members SET data_json = ? WHERE knvb_id = ?'` -> `'UPDATE rondo_club_members SET data_json = ? WHERE knvb_id = ?'`

**Variable names (destructured from DB results that now return rondo_club_id):**
- All `stadion_id` variable references -> `rondo_club_id` (destructuring, assignments, comparisons, template literals, object properties)
- `stadionData` -> `rondoClubData` (already used in conflict-resolver.js with this name)
- `knvbIdToStadionId` -> `knvbIdToRondoClubId` (Map variable)
- `childStadionIds` -> `childRondoClubIds` (array variable in parent sync)
- `nonChildMatch.stadion_id` -> `nonChildMatch.rondo_club_id`

**Function names:**
- `updateChildrenParentLinks(parentId, childStadionIds, options)` -> `updateChildrenParentLinks(parentId, childRondoClubIds, options)` (parameter name only, function name is fine)
- `syncParent(parent, db, knvbIdToStadionId, options)` -> `syncParent(parent, db, knvbIdToRondoClubId, options)` (parameter name only)
- `syncParents(db, knvbIdToStadionId, options)` -> `syncParents(db, knvbIdToRondoClubId, options)` (parameter name only)

**Comments:**
- Update all comment references from stadion to rondo_club (JSDoc, inline comments)
- `prepare-stadion-members.js` in comments -> `prepare-rondo-club-members.js` (if such file exists; if not, just update the comment text to be accurate)

In `steps/upload-photos-to-rondo-club.js` (13 references):

**Function names:**
- `uploadPhotoToStadion` -> `uploadPhotoToRondoClub` (function declaration and all call sites)
- `deletePhotoFromStadion` -> `deletePhotoFromRondoClub` (function declaration and all call sites)

**Variable names:**
- `member.stadion_id` -> `member.rondo_club_id` (all references)
- `stadionDeleted` -> `rondoClubDeleted` (variable in photo deletion logic)
- `stadion_id: member.stadion_id` in error/result objects -> `rondo_club_id: member.rondo_club_id`

**Comments:**
- Update any stadion references in comments
  </action>
  <verify>
Run: `grep -c 'stadion' steps/submit-rondo-club-sync.js` — should return 0.
Run: `grep -c 'stadion' steps/upload-photos-to-rondo-club.js` — should return 0.
Run: `node -e "require('./steps/submit-rondo-club-sync.js')"` — should load without syntax errors.
Run: `node -e "require('./steps/upload-photos-to-rondo-club.js')"` — should load without syntax errors.
  </verify>
  <done>
Both files have zero stadion references. All variable names, SQL queries, function names, and comments use rondo_club naming. Files load without syntax errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rename stadion references in freescout, nikki, and functions step files</name>
  <files>steps/prepare-freescout-customers.js, steps/sync-nikki-to-rondo-club.js, steps/download-functions-from-sportlink.js</files>
  <action>
In `steps/prepare-freescout-customers.js` (8 references):

**SQL queries (CRITICAL):**
- `FROM stadion_members` -> `FROM rondo_club_members`

**Variable/property names:**
- `stadion_id` in SELECT column -> `rondo_club_id`
- `row.stadion_id` -> `row.rondo_club_id`
- `stadion_id: row.stadion_id` -> `rondo_club_id: row.rondo_club_id`

**Comments:**
- `Member record from stadion_members` -> `Member record from rondo_club_members`
- `Format: RONDO_URL/wp-json/wp/v2/media?parent={stadion_id}` -> `...?parent={rondo_club_id}`
- `Get all tracked members from stadion_members` -> `...from rondo_club_members`

In `steps/sync-nikki-to-rondo-club.js` (4 references):

**Variable names:**
- `knvbIdToStadionId` -> `knvbIdToRondoClubId` (Map variable and all usages)
- `member.stadion_id` -> `member.rondo_club_id`

**Logger prefix:**
- `'nikki-stadion'` -> `'nikki-rondo-club'`

**Comments:**
- `knvb_id -> stadion_id mapping` -> `knvb_id -> rondo_club_id mapping`

In `steps/download-functions-from-sportlink.js` (1 reference):

**Comments:**
- `Array of tracked members [{knvb_id, stadion_id}]` -> `[{knvb_id, rondo_club_id}]`
  </action>
  <verify>
Run: `grep -c 'stadion' steps/prepare-freescout-customers.js` — should return 0.
Run: `grep -c 'stadion' steps/sync-nikki-to-rondo-club.js` — should return 0.
Run: `grep -c 'stadion' steps/download-functions-from-sportlink.js` — should return 0.
Run: `node -e "require('./steps/prepare-freescout-customers.js')"` — should load without syntax errors.
Run: `node -e "require('./steps/sync-nikki-to-rondo-club.js')"` — should load without syntax errors.
Run: `node -e "require('./steps/download-functions-from-sportlink.js')"` — should load without syntax errors.
  </verify>
  <done>
All three files have zero stadion references. SQL queries reference rondo_club_members. Variable names use rondo_club_id. Files load without syntax errors.
  </done>
</task>

</tasks>

<verification>
Run from project root:
```bash
grep -r 'stadion' steps/submit-rondo-club-sync.js steps/upload-photos-to-rondo-club.js steps/prepare-freescout-customers.js steps/sync-nikki-to-rondo-club.js steps/download-functions-from-sportlink.js
```
Should return zero matches.

Syntax check all 5 files:
```bash
for f in steps/submit-rondo-club-sync.js steps/upload-photos-to-rondo-club.js steps/prepare-freescout-customers.js steps/sync-nikki-to-rondo-club.js steps/download-functions-from-sportlink.js; do node -e "require('./$f')"; done
```
All should load without errors.
</verification>

<success_criteria>
- Zero `stadion` references in the 5 step files
- All SQL queries reference `rondo_club_members` and `rondo_club_parents`
- All variable names use `rondo_club_id` instead of `stadion_id`
- All function names use `RondoClub` instead of `Stadion`
- All 5 files load without syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/42-code-references/42-01-SUMMARY.md`
</output>
