---
phase: 42-code-references
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - pipelines/sync-individual.js
  - pipelines/sync-all.js
  - pipelines/sync-former-members.js
  - pipelines/reverse-sync.js
  - lib/http-client.js
  - tools/verify-rondo-club-data.js
  - tools/reset-photo-states.js
  - tools/merge-duplicate-person.js
  - tools/clear-commissie-work-history.js
  - tools/cleanup-orphan-relationships.js
  - tools/cleanup-duplicate-former-members.js
  - tools/cleanup-rondo-club-duplicates.js
  - tools/validate-rondo-club-ids.js
  - tools/merge-duplicate-parents.js
  - tools/unmerge-parent-from-child.js
  - tools/repopulate-rondo-club-ids.js
  - tools/verify-all.js
autonomous: true

must_haves:
  truths:
    - "All stadion references in pipeline files are renamed to rondo_club"
    - "All stadion references in tool files are renamed to rondo_club"
    - "SQL queries in pipelines and tools use rondo_club_* table names"
    - "Variable names use rondo_club_id throughout pipelines and tools"
    - "Zero stadion references remain in the codebase outside of migration code in lib/"
  artifacts:
    - path: "pipelines/sync-individual.js"
      provides: "Individual member sync pipeline"
      contains: "rondo_club_id"
    - path: "pipelines/sync-all.js"
      provides: "Full sync pipeline"
      contains: "rondo_club_members"
    - path: "tools/verify-rondo-club-data.js"
      provides: "Rondo Club data verification tool"
      contains: "rondo_club_members"
    - path: "tools/validate-rondo-club-ids.js"
      provides: "Rondo Club ID validation tool"
      contains: "rondo_club_id"
    - path: "tools/verify-all.js"
      provides: "Full verification tool"
      contains: "rondo_club_change_detections"
  key_links:
    - from: "pipelines/sync-individual.js"
      to: "lib/rondo-club-db.js"
      via: "SQL query on rondo_club_members"
      pattern: "FROM rondo_club_members"
    - from: "pipelines/sync-all.js"
      to: "lib/rondo-club-db.js"
      via: "SQL query on rondo_club_members for stats"
      pattern: "FROM rondo_club_members"
    - from: "tools/verify-all.js"
      to: "lib/rondo-club-db.js"
      via: "Table existence check"
      pattern: "rondo_club_change_detections"
---

<objective>
Rename all stadion references to rondo_club in pipeline files, tool files, and the one remaining lib file (http-client.js).

Purpose: Complete the code reference rename across the entire codebase. After this plan, zero stadion references should remain outside of Phase 41 migration code in lib/rondo-club-db.js and lib/discipline-db.js.

Output: 17 files with zero stadion references. Full codebase clean of stadion naming.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@pipelines/sync-individual.js
@pipelines/sync-all.js
@pipelines/sync-former-members.js
@pipelines/reverse-sync.js
@lib/http-client.js
@tools/verify-rondo-club-data.js
@tools/validate-rondo-club-ids.js
@tools/verify-all.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename stadion references in all pipeline files and lib/http-client.js</name>
  <files>pipelines/sync-individual.js, pipelines/sync-all.js, pipelines/sync-former-members.js, pipelines/reverse-sync.js, lib/http-client.js</files>
  <action>
In `pipelines/sync-individual.js` (8 references):

**SQL queries (CRITICAL):**
- `'SELECT stadion_id FROM stadion_members WHERE knvb_id = ?'` -> `'SELECT rondo_club_id FROM rondo_club_members WHERE knvb_id = ?'`

**Variable names:**
- `c.stadion_id` -> `c.rondo_club_id` (in commissieMap construction)
- `{ knvb_id: knvbId, stadion_id: rondoClubId }` -> `{ knvb_id: knvbId, rondo_club_id: rondoClubId }` (destructuring)
- `row?.stadion_id` -> `row?.rondo_club_id`
- `stadionData` -> `rondoClubData`

**Comments:**
- `Get member with stadion_id from database` -> `Get member with rondo_club_id from database`
- `Get stadion_id from database directly` -> `Get rondo_club_id from database directly`

In `pipelines/sync-all.js` (2 references):

**SQL queries (CRITICAL):**
- `'SELECT COUNT(*) as count FROM stadion_members'` -> `'SELECT COUNT(*) as count FROM rondo_club_members'`
- `"SELECT COUNT(*) as count FROM stadion_members WHERE photo_state = 'synced'"` -> `"SELECT COUNT(*) as count FROM rondo_club_members WHERE photo_state = 'synced'"`

In `pipelines/sync-former-members.js` (13 references):

**Variable names:**
- `tracked.stadion_id` -> `tracked.rondo_club_id` (all references)
- `const { knvb_id, prepared, stadion_id } = toSync[i]` -> `const { knvb_id, prepared, rondo_club_id } = toSync[i]`
- All subsequent `stadion_id` references in function -> `rondo_club_id`
- `stadion_id: (tracked && tracked.stadion_id) ...` -> `rondo_club_id: (tracked && tracked.rondo_club_id) ...`
- `member.stadion_id` -> `member.rondo_club_id`

**Comments:**
- `Skip if member already exists in database with a stadion_id` -> `...with a rondo_club_id`
- `Track in stadion_members table` -> `Track in rondo_club_members table`
- `Update sync state with stadion_id` -> `...with rondo_club_id`
- `no stadion_id` -> `no rondo_club_id`

In `pipelines/reverse-sync.js` (1 reference):

**Comments:**
- `Detect Rondo Club changes to populate stadion_change_detections table` -> `...rondo_club_change_detections table`

In `lib/http-client.js` (1 reference):

**Comments:**
- `Consolidates common HTTP request logic used by stadion-client and freescout-client.` -> `Consolidates common HTTP request logic used by rondo-club-client and freescout-client.`
  </action>
  <verify>
Run: `grep -c 'stadion' pipelines/sync-individual.js pipelines/sync-all.js pipelines/sync-former-members.js pipelines/reverse-sync.js lib/http-client.js` — all should return 0.
Run: `node -e "require('./pipelines/sync-individual.js')"` — no syntax errors.
Run: `node -e "require('./pipelines/sync-all.js')"` — no syntax errors.
Run: `node -e "require('./pipelines/sync-former-members.js')"` — no syntax errors.
Run: `node -e "require('./pipelines/reverse-sync.js')"` — no syntax errors.
  </verify>
  <done>
All 5 files have zero stadion references. SQL queries reference rondo_club_members. Variable names use rondo_club_id. Files load without syntax errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rename stadion references in all tool files</name>
  <files>tools/verify-rondo-club-data.js, tools/reset-photo-states.js, tools/merge-duplicate-person.js, tools/clear-commissie-work-history.js, tools/cleanup-orphan-relationships.js, tools/cleanup-duplicate-former-members.js, tools/cleanup-rondo-club-duplicates.js, tools/validate-rondo-club-ids.js, tools/merge-duplicate-parents.js, tools/unmerge-parent-from-child.js, tools/repopulate-rondo-club-ids.js, tools/verify-all.js</files>
  <action>
In `tools/verify-rondo-club-data.js` (20 references):

**Table name strings (CRITICAL):**
- `table: 'stadion_members'` -> `table: 'rondo_club_members'`
- `table: 'stadion_parents'` -> `table: 'rondo_club_parents'`
- `table: 'stadion_teams'` -> `table: 'rondo_club_teams'`
- `table: 'stadion_commissies'` -> `table: 'rondo_club_commissies'`

**Column name strings:**
- `idColumn: 'stadion_id'` -> `idColumn: 'rondo_club_id'` (all 4 occurrences)

**Variable names:**
- `stadionCount` -> `rondoClubCount` (result property and display)

**Comments/help text:**
- `Invalid stadion_ids` -> `Invalid rondo_club_ids`
- `Nullify invalid stadion_ids` -> `Nullify invalid rondo_club_ids`
- `node scripts/verify-stadion-data.js` -> `node scripts/verify-rondo-club-data.js` (or update to reflect actual script path)
- `Members (stadion_members → /wp/v2/people)` -> `Members (rondo_club_members → /wp/v2/people)` (and similar for Parents, Teams, Commissies)
- `Missing mappings (tracked locally but no stadion_id)` -> `...no rondo_club_id`

In `tools/reset-photo-states.js` (4 references):

**SQL table names (CRITICAL):**
- `FROM stadion_members` -> `FROM rondo_club_members` (2 occurrences)
- `UPDATE stadion_members` -> `UPDATE rondo_club_members`

**Comments:**
- `stadion_members.person_image_date` -> `rondo_club_members.person_image_date`

In `tools/merge-duplicate-person.js` (1 reference):

**SQL table name (CRITICAL):**
- `'DELETE FROM stadion_parents WHERE email = ?'` -> `'DELETE FROM rondo_club_parents WHERE email = ?'`

In `tools/clear-commissie-work-history.js` (2 references):

**Variable names:**
- `m.stadion_id` -> `m.rondo_club_id`

**Comments:**
- `Get their stadion_ids` -> `Get their rondo_club_ids`

In `tools/cleanup-orphan-relationships.js` (4 references):

**Function/variable names:**
- `getAllStadionPeople()` -> `getAllRondoClubPeople()` (function name and call site)
- `stadionPeople` -> `rondoClubPeople` (variable name, all references)

In `tools/cleanup-duplicate-former-members.js` (5 references):

**SQL queries (CRITICAL):**
- `'SELECT stadion_id FROM stadion_members WHERE stadion_id IS NOT NULL'` -> `'SELECT rondo_club_id FROM rondo_club_members WHERE rondo_club_id IS NOT NULL'`

**Variable names:**
- `r.stadion_id` -> `r.rondo_club_id`

**Comments:**
- `stadion_members DB` -> `rondo_club_members DB`
- `tracked stadion_ids` -> `tracked rondo_club_ids`

In `tools/cleanup-rondo-club-duplicates.js` (3 references):

**Function/variable names:**
- `getAllStadionPeople()` -> `getAllRondoClubPeople()` (function name and call site)
- `stadionPeople` -> `rondoClubPeople`

In `tools/validate-rondo-club-ids.js` (9 references):

**Function names:**
- `getAllStadionPeopleIds()` -> `getAllRondoClubPeopleIds()`

**SQL queries (CRITICAL):**
- `'SELECT knvb_id, stadion_id FROM stadion_members WHERE stadion_id IS NOT NULL'` -> `'SELECT knvb_id, rondo_club_id FROM rondo_club_members WHERE rondo_club_id IS NOT NULL'`
- `'UPDATE stadion_members SET stadion_id = NULL, last_synced_hash = NULL WHERE knvb_id = ?'` -> `'UPDATE rondo_club_members SET rondo_club_id = NULL, last_synced_hash = NULL WHERE knvb_id = ?'`

**Variable names:**
- `m.stadion_id` -> `m.rondo_club_id`

**Comments/log messages:**
- `invalid stadion_id` -> `invalid rondo_club_id`
- `Invalid stadion_ids` -> `Invalid rondo_club_ids`
- `Nullifying invalid stadion_ids` -> `Nullifying invalid rondo_club_ids`
- `stale stadion_ids` -> `stale rondo_club_ids`
- `Check tracking DB for invalid stadion_ids` -> `...invalid rondo_club_ids`

In `tools/merge-duplicate-parents.js` (11 references):

**SQL queries (CRITICAL):**
- All `FROM stadion_parents` -> `FROM rondo_club_parents`
- All `JOIN stadion_members` -> `JOIN rondo_club_members`
- `'UPDATE stadion_parents SET stadion_id = ? WHERE LOWER(email) = LOWER(?)'` -> `'UPDATE rondo_club_parents SET rondo_club_id = ? WHERE LOWER(email) = LOWER(?)'` (2 occurrences)

**Variable/column references:**
- `p.stadion_id` -> `p.rondo_club_id`
- `m.stadion_id` -> `m.rondo_club_id`
- `parent_sid` alias stays (it's an AS alias), but ensure the source column changes

**Comments:**
- `Find all parents whose stadion_id differs` -> `...rondo_club_id differs`
- `Update parent tracking to point to member's stadion_id` -> `...rondo_club_id`

In `tools/unmerge-parent-from-child.js` (9 references):

**SQL queries (CRITICAL):**
- `'SELECT email, stadion_id, data_json FROM stadion_parents WHERE stadion_id IS NOT NULL'` -> `'SELECT email, rondo_club_id, data_json FROM rondo_club_parents WHERE rondo_club_id IS NOT NULL'`
- `'SELECT stadion_id FROM stadion_members WHERE knvb_id = ?'` -> `'SELECT rondo_club_id FROM rondo_club_members WHERE knvb_id = ?'`
- `'UPDATE stadion_parents SET stadion_id = NULL, last_synced_hash = NULL WHERE email = ?'` -> `'UPDATE rondo_club_parents SET rondo_club_id = NULL, last_synced_hash = NULL WHERE email = ?'`

**Variable names:**
- `p.stadion_id` -> `p.rondo_club_id`
- `child.stadion_id` -> `child.rondo_club_id`
- `childStadionId` -> `childRondoClubId` (in fix object)

**Comments:**
- `Finds all parents whose stadion_id points to one of their own children` -> `...rondo_club_id`
- `Resets the parent's stadion_id to NULL` -> `...rondo_club_id`
- `Reset parent's stadion_id so next sync creates a fresh post` -> `...rondo_club_id`

In `tools/repopulate-rondo-club-ids.js` (9 references):

**Function names:**
- `fetchAllPeopleFromStadion(options)` -> `fetchAllPeopleFromRondoClub(options)` (function name and call site)

**SQL queries (CRITICAL):**
- `FROM stadion_members` -> `FROM rondo_club_members`

**Variable/column names:**
- `member.stadion_id` -> `member.rondo_club_id`
- `stadion_id` references in log messages and comments -> `rondo_club_id`

**Comments:**
- `Map<knvb_id, stadion_id>` -> `Map<knvb_id, rondo_club_id>`
- `Repopulate stadion_ids` -> `Repopulate rondo_club_ids`
- `including those without stadion_id` -> `...without rondo_club_id`
- `Update the stadion_id` -> `Update the rondo_club_id`

In `tools/verify-all.js` (1 reference):

**Table name string (CRITICAL):**
- `'stadion_change_detections'` -> `'rondo_club_change_detections'`
  </action>
  <verify>
Run: `for f in tools/verify-rondo-club-data.js tools/reset-photo-states.js tools/merge-duplicate-person.js tools/clear-commissie-work-history.js tools/cleanup-orphan-relationships.js tools/cleanup-duplicate-former-members.js tools/cleanup-rondo-club-duplicates.js tools/validate-rondo-club-ids.js tools/merge-duplicate-parents.js tools/unmerge-parent-from-child.js tools/repopulate-rondo-club-ids.js tools/verify-all.js; do echo "$f: $(grep -c 'stadion' $f)"; done` — all should return 0.

Syntax check critical tools:
```bash
node -e "require('./tools/verify-rondo-club-data.js')"
node -e "require('./tools/validate-rondo-club-ids.js')"
node -e "require('./tools/verify-all.js')"
node -e "require('./tools/repopulate-rondo-club-ids.js')"
```
All should load without errors.
  </verify>
  <done>
All 12 tool files have zero stadion references. SQL queries reference rondo_club_* tables and columns. Function names use RondoClub instead of Stadion. All files load without syntax errors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Final codebase-wide verification of stadion references</name>
  <files></files>
  <action>
Run a comprehensive grep across the entire codebase (excluding node_modules, .planning, data, .git) to verify that stadion references ONLY remain in:

1. `lib/rondo-club-db.js` — migration function code (expected, these are the migration FROM names)
2. `lib/discipline-db.js` — migration function code (expected)

Any stadion reference found in steps/, pipelines/, tools/, other lib/ files, config/, or scripts/ is a bug that must be fixed.

**Expected exceptions (do NOT fix):**
- `lib/rondo-club-db.js` migration code referencing old table names (e.g., `stadion_members` in SQL that reads from old table during migration)
- `lib/discipline-db.js` migration code checking for `stadion_id` column

**Action if unexpected references found:** Fix them using the same rename patterns from Tasks 1-2.
  </action>
  <verify>
Run: `grep -r --include='*.js' 'stadion' --exclude-dir=node_modules --exclude-dir=.planning --exclude-dir=data . | grep -v 'lib/rondo-club-db.js' | grep -v 'lib/discipline-db.js'` — should return zero matches.
  </verify>
  <done>
Zero stadion references remain in the codebase outside of migration code in lib/rondo-club-db.js and lib/discipline-db.js. The rename is complete.
  </done>
</task>

</tasks>

<verification>
Final codebase-wide verification:
```bash
# Count stadion references per directory (excluding migration files and non-code)
grep -r --include='*.js' 'stadion' --exclude-dir=node_modules --exclude-dir=.planning --exclude-dir=data steps/ pipelines/ tools/ lib/http-client.js
```
Should return zero matches.

```bash
# Verify only expected migration files still have stadion references
grep -rl --include='*.js' 'stadion' --exclude-dir=node_modules --exclude-dir=.planning --exclude-dir=data .
```
Should return ONLY:
- `./lib/rondo-club-db.js`
- `./lib/discipline-db.js`
</verification>

<success_criteria>
- Zero `stadion` references in any pipeline file
- Zero `stadion` references in any tool file
- Zero `stadion` references in lib/http-client.js
- All SQL queries across the codebase reference `rondo_club_*` tables
- All variable names use `rondo_club_id` instead of `stadion_id`
- Only migration code in lib/rondo-club-db.js and lib/discipline-db.js retains stadion references
- All modified files load without syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/42-code-references/42-03-SUMMARY.md`
</output>
