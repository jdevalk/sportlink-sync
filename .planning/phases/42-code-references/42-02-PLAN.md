---
phase: 42-code-references
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - steps/submit-rondo-club-teams.js
  - steps/submit-rondo-club-work-history.js
  - steps/submit-rondo-club-commissies.js
  - steps/submit-rondo-club-commissie-work-history.js
  - steps/submit-rondo-club-discipline.js
  - steps/sync-important-dates.js
autonomous: true

must_haves:
  truths:
    - "All stadion references in team/commissie/discipline step files are renamed to rondo_club"
    - "SQL queries in steps use rondo_club_members table name"
    - "Variable names use rondo_club_id instead of stadion_id throughout"
    - "Function parameter names and local variable names use rondo_club naming"
  artifacts:
    - path: "steps/submit-rondo-club-teams.js"
      provides: "Team sync to Rondo Club"
      contains: "rondo_club_id"
    - path: "steps/submit-rondo-club-work-history.js"
      provides: "Team work history sync"
      contains: "rondo_club_work_history_id"
    - path: "steps/submit-rondo-club-commissies.js"
      provides: "Commissie sync to Rondo Club"
      contains: "rondo_club_id"
    - path: "steps/submit-rondo-club-commissie-work-history.js"
      provides: "Commissie work history sync"
      contains: "rondo_club_work_history_id"
    - path: "steps/submit-rondo-club-discipline.js"
      provides: "Discipline case sync to Rondo Club"
      contains: "rondo_club_id"
    - path: "steps/sync-important-dates.js"
      provides: "Important dates sync"
      contains: "rondoClubPersonId"
  key_links:
    - from: "steps/submit-rondo-club-discipline.js"
      to: "lib/rondo-club-db.js"
      via: "SQL query on rondo_club_members for person lookup"
      pattern: "FROM rondo_club_members"
    - from: "steps/submit-rondo-club-work-history.js"
      to: "lib/rondo-club-db.js"
      via: "DB function return values with rondo_club_id"
      pattern: "rondo_club_work_history_id"
---

<objective>
Rename all stadion references to rondo_club in the team, commissie, discipline, and important dates step files.

Purpose: These step files consume DB layer output from rondo-club-db.js (updated in Phase 41) and must now destructure and reference the new column names (rondo_club_id, rondo_club_work_history_id, etc.).

Output: 6 step files with zero stadion references.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@steps/submit-rondo-club-teams.js
@steps/submit-rondo-club-work-history.js
@steps/submit-rondo-club-commissies.js
@steps/submit-rondo-club-commissie-work-history.js
@steps/submit-rondo-club-discipline.js
@steps/sync-important-dates.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename stadion references in teams, work history, and commissie step files</name>
  <files>steps/submit-rondo-club-teams.js, steps/submit-rondo-club-work-history.js, steps/submit-rondo-club-commissies.js, steps/submit-rondo-club-commissie-work-history.js</files>
  <action>
In `steps/submit-rondo-club-teams.js` (21 references):

**Variable names (destructured from DB results):**
- `let { stadion_id } = team` -> `let { rondo_club_id } = team`
- All subsequent `stadion_id` references in the function -> `rondo_club_id` (comparisons, template literals, return values, API endpoint construction, log messages)
- `orphan.stadion_id` -> `orphan.rondo_club_id`
- `trackedStadionIds` -> `trackedRondoClubIds`
- `t.stadion_id` -> `t.rondo_club_id` (in filter/map operations)

**Comments:**
- `Uses local stadion_id tracking` -> `Uses local rondo_club_id tracking`
- `prepare-stadion-teams.js` -> update to accurate reference
- `Re-fetch teams to get updated stadion_ids` -> `...rondo_club_ids`

In `steps/submit-rondo-club-work-history.js` (23 references):

**Function names:**
- `lookupTeamStadionId(teamCode, teamMap)` -> `lookupTeamRondoClubId(teamCode, teamMap)`
- `buildWorkHistoryEntry(teamStadionId, isBackfill, jobTitle)` -> `buildWorkHistoryEntry(teamRondoClubId, isBackfill, jobTitle)`
- Update parameter references inside these functions accordingly

**Variable names:**
- `stadion_work_history_id` -> `rondo_club_work_history_id` (all references - tracked history filter, comparison, index lookup)
- `stadionWorkHistoryId` -> `rondoClubWorkHistoryId` (local variable)
- `{ knvb_id, stadion_id } = member` -> `{ knvb_id, rondo_club_id } = member`
- `member.stadion_id` -> `member.rondo_club_id`
- `stadion_id: record.stadion_id` -> `rondo_club_id: record.rondo_club_id`

**Comments:**
- `Map<team_code, stadion_id>` -> `Map<team_code, rondo_club_id>`
- `team_code -> stadion_id` -> `team_code -> rondo_club_id`
- `stadion_work_history_id` in comments -> `rondo_club_work_history_id`

In `steps/submit-rondo-club-commissies.js` (17 references):

**Variable names:**
- `let { stadion_id } = commissie` -> `let { rondo_club_id } = commissie`
- All subsequent `stadion_id` references -> `rondo_club_id`
- `orphan.stadion_id` -> `orphan.rondo_club_id`
- `trackedStadionIds` -> `trackedRondoClubIds`
- `c.stadion_id` -> `c.rondo_club_id`

In `steps/submit-rondo-club-commissie-work-history.js` (16 references):

**Function names:**
- `buildWorkHistoryEntry(commissieStadionId, ...)` -> `buildWorkHistoryEntry(commissieRondoClubId, ...)`

**Variable names:**
- `stadion_work_history_id` -> `rondo_club_work_history_id` (all references)
- `{ knvb_id, stadion_id } = member` -> `{ knvb_id, rondo_club_id } = member`
- `member.stadion_id` -> `member.rondo_club_id`
- `c.stadion_id` -> `c.rondo_club_id` (in commissieMap construction)
- `stadion_id: record.stadion_id` -> `rondo_club_id: record.rondo_club_id`

**Comments:**
- `Map<commissie_name, stadion_id>` -> `Map<commissie_name, rondo_club_id>`
- `stadion_work_history_id` in comments -> `rondo_club_work_history_id`
  </action>
  <verify>
Run: `grep -c 'stadion' steps/submit-rondo-club-teams.js` — should return 0.
Run: `grep -c 'stadion' steps/submit-rondo-club-work-history.js` — should return 0.
Run: `grep -c 'stadion' steps/submit-rondo-club-commissies.js` — should return 0.
Run: `grep -c 'stadion' steps/submit-rondo-club-commissie-work-history.js` — should return 0.
Run: `node -e "require('./steps/submit-rondo-club-teams.js')"` — no syntax errors.
Run: `node -e "require('./steps/submit-rondo-club-work-history.js')"` — no syntax errors.
Run: `node -e "require('./steps/submit-rondo-club-commissies.js')"` — no syntax errors.
Run: `node -e "require('./steps/submit-rondo-club-commissie-work-history.js')"` — no syntax errors.
  </verify>
  <done>
All 4 files have zero stadion references. Variable names, function parameters, and comments all use rondo_club naming. Files load without syntax errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rename stadion references in discipline and important dates step files</name>
  <files>steps/submit-rondo-club-discipline.js, steps/sync-important-dates.js</files>
  <action>
In `steps/submit-rondo-club-discipline.js` (17 references):

**SQL queries (CRITICAL - direct database access):**
- `'SELECT knvb_id, stadion_id FROM stadion_members WHERE stadion_id IS NOT NULL'` -> `'SELECT knvb_id, rondo_club_id FROM rondo_club_members WHERE rondo_club_id IS NOT NULL'`

**Function names:**
- `syncCase(caseData, personStadionId, seasonTermId, ...)` -> `syncCase(caseData, personRondoClubId, seasonTermId, ...)`
- `buildPersonStadionIdLookup(db)` -> `buildPersonRondoClubIdLookup(db)` (rename the function AND all call sites)

**Variable names:**
- `let { stadion_id } = caseData` -> `let { rondo_club_id } = caseData`
- All subsequent `stadion_id` references -> `rondo_club_id` (comparisons, template literals, return values, API endpoints)
- `row.stadion_id` -> `row.rondo_club_id` (in lookup map construction)
- `lookup.set(row.knvb_id, row.stadion_id)` -> `lookup.set(row.knvb_id, row.rondo_club_id)`

**Comments:**
- `Build knvb_id -> stadion_id lookup map` -> `Build knvb_id -> rondo_club_id lookup map`
- `Look up person stadion_id` -> `Look up person rondo_club_id`

In `steps/sync-important-dates.js` (18 references):

**Function names:**
- `createImportantDate(stadionPersonId, ...)` -> `createImportantDate(rondoClubPersonId, ...)`
- `updateImportantDate(stadionDateId, stadionPersonId, ...)` -> `updateImportantDate(rondoClubDateId, rondoClubPersonId, ...)`
- `deleteStadionImportantDate(stadionDateId, ...)` -> `deleteRondoClubImportantDate(rondoClubDateId, ...)`
- Update all call sites of these functions accordingly

**Variable/property names:**
- `date.stadion_date_id` -> `date.rondo_club_date_id` (from DB results)
- `date.stadion_id` -> `date.rondo_club_id` (from DB results)
- `orphan.stadion_date_id` -> `orphan.rondo_club_date_id`

**Comments:**
- `@param {number} stadionPersonId` -> `@param {number} rondoClubPersonId`
- `@param {number} stadionDateId` -> `@param {number} rondoClubDateId`
- `members must have stadion_id` -> `members must have rondo_club_id`
  </action>
  <verify>
Run: `grep -c 'stadion' steps/submit-rondo-club-discipline.js` — should return 0.
Run: `grep -c 'stadion' steps/sync-important-dates.js` — should return 0.
Run: `node -e "require('./steps/submit-rondo-club-discipline.js')"` — no syntax errors.
Run: `node -e "require('./steps/sync-important-dates.js')"` — no syntax errors.
  </verify>
  <done>
Both files have zero stadion references. SQL queries reference rondo_club_members. Function names and parameters use rondoClub naming. Files load without syntax errors.
  </done>
</task>

</tasks>

<verification>
Run from project root:
```bash
grep -r 'stadion' steps/submit-rondo-club-teams.js steps/submit-rondo-club-work-history.js steps/submit-rondo-club-commissies.js steps/submit-rondo-club-commissie-work-history.js steps/submit-rondo-club-discipline.js steps/sync-important-dates.js
```
Should return zero matches.

Syntax check all 6 files:
```bash
for f in steps/submit-rondo-club-teams.js steps/submit-rondo-club-work-history.js steps/submit-rondo-club-commissies.js steps/submit-rondo-club-commissie-work-history.js steps/submit-rondo-club-discipline.js steps/sync-important-dates.js; do node -e "require('./$f')"; done
```
All should load without errors.
</verification>

<success_criteria>
- Zero `stadion` references in the 6 step files
- SQL query in submit-rondo-club-discipline.js references `rondo_club_members` with `rondo_club_id`
- All variable names use `rondo_club_id` or `rondo_club_work_history_id`
- All function names use `RondoClub` instead of `Stadion`
- All 6 files load without syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/42-code-references/42-02-SUMMARY.md`
</output>
