# Milestone v1.7: MemberHeader API

**Status:** ✅ SHIPPED 2026-01-28
**Phases:** 17-19
**Total Plans:** 6

## Overview

This milestone optimizes data capture and photo sync by using the MemberHeader API response already available during the `/other` page visit. Instead of browser scraping for photos and missing financial data entirely, we extract structured data from the API response: financial transfer block status and direct photo URLs with dates. This enables new financial block tracking in Stadion and eliminates brittle browser-based photo downloads.

## Phases

### Phase 17: MemberHeader Data Capture

**Goal**: Extract and store financial block status and photo metadata from MemberHeader API response

**Depends on**: None (extends existing `/other` page visit)

**Plans**: 1 plan

Plans:
- [x] 17-01: Capture MemberHeader API and store financial block + photo metadata

**Details:**
- Reuses existing browser navigation to `/other` page (no additional page loads)
- Captures MemberHeader API in parallel with MemberFreeFields
- Foundation for Phases 18 and 19

---

### Phase 18: Financial Block Sync

**Goal**: Sync financial transfer block status from Sportlink to Stadion WordPress

**Depends on**: Phase 17 (requires financial block data in database)

**Plans**: 1 plan

Plans:
- [x] 18-01: Sync financial block to Stadion ACF field with activity logging

**Details:**
- Extends existing Stadion sync flow (submit-stadion-sync.js)
- Non-critical sync (failures don't block other operations)
- Activity logging for audit trail ("Financiele blokkade ingesteld/opgeheven")

---

### Phase 19: Photo API Optimization

**Goal**: Replace browser-based photo download with direct API URL fetch

**Depends on**: Phase 17 (requires Photo.Url and Photo.PhotoDate in database)

**Plans**: 4 plans

Plans:
- [x] 19-01: Extend MemberHeader capture to ALL members, add photo_url/photo_date to stadion_members
- [x] 19-02: Create HTTP-based photo download script with retry logic
- [x] 19-03: Integrate photo sync into people pipeline, update cron
- [x] 19-04: Delete obsolete files, update documentation

**Details:**
- Significantly faster than browser automation (direct URL fetch vs page navigation + modal interaction)
- Reduces failure surface (no DOM selectors to break)
- Photo upload and deletion logic stays the same (only download changes)
- Photos now sync hourly as part of people pipeline (was daily)

---

## Milestone Summary

**Key Decisions:**
- Use MemberHeader API instead of new requests (already fetched during `/other` page visit)
- Three-phase structure (Data → Financial → Photo) with dependencies
- INTEGER for has_financial_block (SQLite has no native boolean)
- Activity logging as non-blocking enhancement
- Store photo_url/photo_date in stadion_members for direct access
- HTTP fetch with 3-retry exponential backoff
- Integrate photo sync into people pipeline (hourly vs daily)

**Issues Resolved:**
- Browser-based photo download was brittle and slow
- Financial block status was not being captured
- Photo change detection used PersonImageDate which could be stale
- Five separate cron jobs was unnecessarily complex

**Technical Debt Incurred:**
None - all phases verified clean with no TODO/FIXME comments.

---

*For current project status, see .planning/ROADMAP.md*

---

*Archived: 2026-01-28 as part of v1.7 milestone completion*
