# Requirements Archive: v2.0 Bidirectional Sync

**Archived:** 2026-01-29
**Status:** SHIPPED

This is the archived requirements specification for v2.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Sportlink Sync v2.0

**Defined:** 2026-01-29
**Core Value:** Keep downstream systems (Laposta, Stadion) automatically in sync with Sportlink member data without manual intervention — now bidirectionally

## v2.0 Requirements

Requirements for bidirectional sync. Each maps to roadmap phases.

### Foundation

- [x] **FOUND-01**: Sync operations track origin (user edit vs sync-initiated) to prevent infinite loops
- [x] **FOUND-02**: SQLite tracks modification timestamps in both directions (forward and reverse)
- [x] **FOUND-03**: All timestamps normalized to UTC before comparison

### Conflict Resolution

- [x] **CONF-01**: System compares modification timestamps to determine last-edit-wins
- [x] **CONF-02**: Conflict resolution operates at field level, not whole record
- [x] **CONF-03**: Operator receives notification when conflicts are detected and resolved

### Reverse Sync

- [x] **RSYNC-01**: System queries Stadion to detect members with modifications newer than Sportlink
- [x] **RSYNC-02**: Contact fields (email, email2, mobile, phone) sync from Stadion to Sportlink /general page
- [x] **RSYNC-03**: Free fields (datum-vog, freescout-id) sync from Stadion to Sportlink /other page
- [x] **RSYNC-04**: Financial block toggle syncs from Stadion to Sportlink /financial page

### Integration

- [x] **INTEG-01**: All reverse sync operations logged with timestamps and field values for audit
- [x] **INTEG-02**: Email reports include reverse sync statistics (members updated, conflicts resolved)
- [x] **INTEG-03**: Reverse sync runs on separate cron schedule (every 15 minutes)

## Future Requirements

Deferred to later milestones.

### Reliability Enhancements

- **REL-01**: Dry run mode previews reverse sync changes without applying
- **REL-02**: Automatic retry with exponential backoff on transient failures
- **REL-03**: Multiple fallback selectors per Sportlink field
- **REL-04**: Pre-sync validation (email format, phone format)
- **REL-05**: Selector smoke tests detect Sportlink UI changes

### Advanced Conflict Handling

- **ADVCONF-01**: Field-specific authority policies (some fields always prefer Sportlink)
- **ADVCONF-02**: Grace period for clock drift tolerance (5-minute window)

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Real-time sync | Scheduled batch sync is sufficient for member data |
| Three-way merge | Last-edit-wins is simpler and predictable |
| Delete sync | Never auto-delete in Sportlink; manual only |
| Bidirectional photo sync | Photos only flow Sportlink → Stadion (correct design) |
| Full bidirectional sync | Only specific fields sync back; Sportlink remains primary source |

## Traceability

Which phases cover which requirements.

| Requirement | Phase | Status |
|-------------|-------|--------|
| FOUND-01 | Phase 20 | Complete |
| FOUND-02 | Phase 20 | Complete |
| FOUND-03 | Phase 20 | Complete |
| CONF-01 | Phase 21 | Complete |
| CONF-02 | Phase 21 | Complete |
| CONF-03 | Phase 21, 26 | Complete |
| RSYNC-01 | Phase 22, 25 | Complete |
| RSYNC-02 | Phase 23 | Complete |
| RSYNC-03 | Phase 24 | Complete |
| RSYNC-04 | Phase 24 | Complete |
| INTEG-01 | Phase 22, 25 | Complete |
| INTEG-02 | Phase 24, 25, 26 | Complete |
| INTEG-03 | Phase 24 | Complete |

**Coverage:**
- v2.0 requirements: 13 total
- Mapped to phases: 13
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 13 of 13 v2.0 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-01-29 as part of v2.0 milestone completion*
