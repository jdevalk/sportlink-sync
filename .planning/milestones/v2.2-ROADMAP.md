# Roadmap: Sportlink Sync v2.2 - Discipline Cases

## Overview

This milestone adds discipline case sync from Sportlink to Stadion. Browser automation captures individual discipline cases ("Individuele tuchtzaken") from Sportlink, stores them in SQLite, and syncs to Stadion as a custom post type with season-based organization and person linking.

## Phases

**Phase Numbering:** Continues from v2.1 (ended at Phase 29). Phases 30-32 for this milestone.

- [x] **Phase 30: Download Discipline Cases** - Capture cases from Sportlink via browser automation
- [ ] **Phase 31: Stadion Sync with Season Organization** - Create/update cases in Stadion with ACF fields and season categories
- [ ] **Phase 32: Pipeline Integration** - Weekly cron, email reports, CLI command

## Phase Details

### Phase 30: Download Discipline Cases
**Goal**: Cases from Sportlink are captured and stored locally
**Depends on**: Nothing (first phase of milestone)
**Requirements**: DISC-01, DISC-02, DISC-03
**Success Criteria** (what must be TRUE):
  1. Running download script navigates to `/competition-affairs/discipline-cases` and clicks "Individuele tuchtzaken" tab
  2. DisciplineClubCasesPlayer API response is captured via page.waitForResponse()
  3. Cases are stored in SQLite with all fields (DossierId as unique key)
  4. Re-running download updates existing cases (upsert pattern)
**Plans:** 1 plan
Plans:
- [x] 30-01-PLAN.md - Create discipline database module and download script

### Phase 31: Stadion Sync with Season Organization
**Goal**: Cases sync to Stadion as posts with person linking and season categories
**Depends on**: Phase 30
**Requirements**: DISC-04, DISC-05, DISC-06, DISC-09, DISC-10, DISC-11
**Success Criteria** (what must be TRUE):
  1. Cases create/update as `discipline-cases` custom post type in Stadion
  2. All case fields map to Stadion ACF fields (DossierId, MatchDate, SanctionDescription, etc.)
  3. Cases link to persons via ACF relationship field using PublicPersonId -> stadion_id mapping
  4. Season is derived from MatchDate (Aug 1 boundary) and assigned as category
  5. Season categories auto-create if they don't exist (e.g., "2025-2026")
**Plans:** 1 plan
Plans:
- [ ] 31-01-PLAN.md - Extend discipline-db.js and create sync script

### Phase 32: Pipeline Integration
**Goal**: Discipline sync runs automatically with reporting
**Depends on**: Phase 31
**Requirements**: DISC-12, DISC-13, DISC-14
**Success Criteria** (what must be TRUE):
  1. `scripts/sync.sh discipline` command works
  2. Cron runs weekly discipline sync
  3. Email report includes discipline case statistics (created, updated, linked)
**Plans**: TBD

## Progress

**Execution Order:** 30 -> 31 -> 32

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 30. Download Discipline Cases | 1/1 | Complete | 2026-02-02 |
| 31. Stadion Sync with Season Organization | 0/1 | Planned | - |
| 32. Pipeline Integration | 0/? | Not started | - |

## Notes

**Deferred:** Stadion UI Integration (DISC-07, DISC-08) deferred to Stadion codebase. The sync delivers data; Stadion-side work handles display templates for player cards and related cases lists.
