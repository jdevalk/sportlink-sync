# Milestone v1.5: Team Sync

**Status:** ✅ SHIPPED 2026-01-26
**Phases:** 13-15
**Total Plans:** 3

## Overview

Sync member teams from Sportlink to Stadion, creating teams and work history entries. Members are linked to their teams via ACF work_history repeater fields with change detection for team reassignments.

## Phases

### Phase 13: Team Extraction and Management

**Goal**: Extract unique team names from Sportlink and create teams in Stadion via REST API
**Depends on**: Phase 12 (existing member sync infrastructure)
**Plans**: 1 plan

Plans:
- [x] 13-01: Team extraction and Stadion team creation

**Details:**
- Extract team from UnionTeams field (priority) with ClubTeams fallback
- Create teams in Stadion via POST /wp/v2/teams
- SQLite stadion_teams table tracks team name → Stadion ID mappings
- COLLATE NOCASE uniqueness prevents capitalization duplicates
- Hash-based change detection for efficient incremental sync

### Phase 14: Work History Sync

**Goal**: System links persons to their teams via work history entries with change detection
**Depends on**: Phase 13 (needs teams to exist in Stadion)
**Plans**: 1 plan

Plans:
- [x] 14-01: Work history creation and team change detection

**Details:**
- ACF work_history repeater field links persons to teams
- Work history uses "Speler" as job_title, is_current = true
- SQLite stadion_work_history table with composite unique (knvb_id, team_name)
- Track WordPress repeater field row indices for update targeting
- Preserve manually-created WordPress entries alongside sync entries
- Team change detection: end old assignment, create new entry

### Phase 15: Pipeline Integration

**Goal**: Team sync integrated into daily pipeline with email reporting
**Depends on**: Phase 14 (complete team sync functionality)
**Plans**: 1 plan

Plans:
- [x] 15-01: Integrate team and work history sync into pipeline with email reporting

**Details:**
- Team sync runs at Step 4b in sync-all.js (after member sync)
- Work history sync runs at Step 4c (after team sync)
- TEAM SYNC and WORK HISTORY SYNC sections in email report
- Non-critical pattern (try-catch) prevents blocking other operations
- Errors aggregated in consolidated ERRORS section

---

## Milestone Summary

**Key Decisions:**
- COLLATE NOCASE on team_name (prevents capitalization duplicates)
- UnionTeams priority over ClubTeams (KNVB data more authoritative)
- Track WordPress repeater field row indices (stadion_work_history_id for update targeting)
- Preserve manual WordPress entries (only modify sync-created work_history)
- Composite unique key (knvb_id, team_name) for member-team tracking
- Team sync before work history (dependency: work history references team IDs)
- Non-critical pattern for team/work history sync (prevents blocking other operations)

**Issues Resolved:**
- None - clean implementation following established patterns

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
